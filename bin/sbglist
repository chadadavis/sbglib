#!/usr/bin/env perl

=head1 NAME

B<sbglist> - Interface to cached objects 

=head1 SYNOPSIS

sbglist <sub-name> object(s).stor more-object(s).stor [field-name]


=head1 DESCRIPTION

Calls sub-name over all the objects in the given files. Optional field-name can extract a certain value from the objects. E.g. get the average of a field/method named 'rg' over all objects:

sbglist List::Util::sum files.stor [more-files.stor] 'rg'


=head1 OPTIONS

=head2 -h Print this help page

=head1 SEE ALSO



=cut

################################################################################

# CPAN
use Getopt::Long;
use Pod::Usage;
use Storable;
use List::Util qw(reduce);
use List::MoreUtils;
use SBG::List qw(retrieve_files);

# Things (i.e. data structures) that make sense to serialize
use SBG::Domain;
use SBG::Transform;
use SBG::Interaction;
use SBG::Complex;

my %ops;
my $result = GetOptions(\%ops, 
                        'h|help',
    );
if ($ops{'h'}) { pod2usage(-exitval=>1, -verbose=>2); }

my $function = shift;
my $method = pop @ARGV;
my @files = @ARGV;
if ( -r $method) { 
    push @files, $method;
    undef $method;
}
@files or pod2usage(-exitval=>2);
my @objs = retrieve_files(@files);
my $res;

if ($method) {
    $res = &$function(map { $_->$method } @objs);
} else {
    $res = &$function(@objs);
}
print $res, "\n";



