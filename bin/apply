#!/usr/bin/env perl

use strict;

use File::Basename;
use SBG::Domain;
use SBG::DomainIO;
use SBG::STAMP;

my ($tfile, @files) = @ARGV;
die unless $tfile;
my $io = new SBG::DomainIO(-file=>$tfile);
my $dom = $io->read;
my $t = $dom->transformation;
print "$tfile:\n$t\n";

foreach my $file (@files) {
    my @doms;
    my $io = new SBG::DomainIO(-file=>$file);

    if ($file =~ /^(.*?)(\d+)?(\..*)?$/) {
        $file = $1 . ($2+1) . $3;
    }
    print STDERR "$file :\n";

    while (my $d = $io->read) {
        my $n = 0;
        if ($d->label =~ /^(.*)(\d+)$/) {
            $n = $2;
            $d->label($1);
        }
        $n++;
        $d->label($d->label . $n);
        print STDERR "\t$d";
        $d->transform($t);
        print STDERR "\n";
        push @doms, $d;
    }
    $io->close;

    $io = new SBG::DomainIO(-file=>">$file");
    foreach my $d (@doms) {
        $io->write($d);
    }
}

__END__



